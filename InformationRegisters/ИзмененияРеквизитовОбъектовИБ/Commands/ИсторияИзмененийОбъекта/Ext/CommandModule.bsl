
&НаКлиенте
Процедура ОбработкаКоманды(ПараметрКоманды, ПараметрыВыполненияКоманды)
	//Вставить содержимое обработчика.
		
	Если Не ВедетсяРегистрацияИзменений(ПараметрКоманды) Тогда
		Если БюджетныйНаСервере.РольАдминаДоступнаСервер() Тогда
			Ответ = Вопрос("Для данного типа объектов не ведется регистрация изменений. Включить регистрацию?", РежимДиалогаВопрос.ДаНет);
			Если Ответ = КодВозвратаДиалога.Да Тогда
				ВключитьРегистрациюИзменений(ПараметрКоманды);
			КонецЕсли;
		Иначе 
			Сообщить("Для данного типа объектов не ведется регистрация изменений");
		КонецЕсли;
		Возврат;
	КонецЕсли;
	
	ПараметрыФормы = Новый Структура("Объект", ПараметрКоманды);
	ТекФорма = ПолучитьФорму("РегистрСведений.ИзмененияРеквизитовОбъектовИБ.ФормаСписка", ПараметрыФормы);
	//ТекФорма = ПолучитьФорму("РегистрСведений.ИзмененияРеквизитовОбъектовИБ.ФормаСписка", ПараметрыФормы, ПараметрыВыполненияКоманды.Источник, ПараметрыВыполненияКоманды.Уникальность, ПараметрыВыполненияКоманды.Окно);
	
	//очищаем отбор
	//ОтборКУдалению = Новый Массив;
	//Для каждого ТекСтрокаОтбора Из ТекФорма.Список.Отбор.Элементы Цикл
	//	ТекСтрокаОтбора.Использование = Ложь;
	//	Если ТекСтрокаОтбора.Ключ = "Объект" Тогда
	//		ОтборКУдалению.Добавить(ТекСтрокаОтбора);	
	//	КонецЕсли;
	//КонецЦикла;
	//
	//Для каждого кУД Из ОтборКУдалению Цикл
	//	ТекФорма.Список.Отбор.Элементы.Удалить(кУД);	
	//КонецЦикла;
	
	//ТекФорма.Список.КомпоновщикНастроек.ПользовательскиеНастройки.Элементы.Очистить();
	
	ПользовательскийОтбор = ТекФорма.Список.КомпоновщикНастроек.ПользовательскиеНастройки.Элементы.Найти(ТекФорма.Список.КомпоновщикНастроек.Настройки.Отбор.ИдентификаторПользовательскойНастройки);
	ПользовательскийОтбор.Элементы.Очистить();
	
	
	//ЭлементОтбора = ПользовательскийОтбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
	//ЭлементОтбора.ЛевоеЗначение = Новый ПолеКомпоновкиДанных("Объект");
	//ЭлементОтбора.ВидСравнения = ВидСравненияКомпоновкиДанных.Равно;
	//ЭлементОтбора.Использование = Истина;
	//ЭлементОтбора.ПравоеЗначение = ПараметрКоманды;
	
	
	//НовыйОтбор = ТекФорма.Список.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
	//НовыйОтбор.ЛевоеЗначение = Новый ПолеКомпоновкиДанных("Объект");
	//НовыйОтбор.ВидСравнения = ВидСравненияКомпоновкиДанных.Равно;
	//НовыйОтбор.ПравоеЗначение = ПараметрКоманды;
	ТекФорма.Открыть();
	
КонецПроцедуры

&НаСервере
Функция ВедетсяРегистрацияИзменений(Ссылка)
	
	МетаданныеИсточника 	= Ссылка.Метаданные();
	РегистрСписокОбъектов	= РегистрыСведений.ОбъектыДляРегистрацииИзмененийИБ;
	Отбор					= Новый Структура("Объект", МетаданныеИсточника.ПолноеИмя());	
	ВедетсяРегистрация 		= РегистрСписокОбъектов.Получить(Отбор)["Регистрировать"];
	
	Возврат ВедетсяРегистрация;
	
КонецФункции

&НаСервере
Процедура ВключитьРегистрациюИзменений(Ссылка)
	
	МетаданныеИсточника = Ссылка.Метаданные();
	МенеджерЗаписи = РегистрыСведений.ОбъектыДляРегистрацииИзмененийИБ.СоздатьМенеджерЗаписи();
	МенеджерЗаписи.Объект = МетаданныеИсточника.ПолноеИмя();
	МенеджерЗаписи.Регистрировать = Истина;
	МенеджерЗаписи.Записать();
	
КонецПроцедуры