
&НаКлиенте
Процедура УстановитьДоступность(Команда)
	
	Для Каждого ТекущийДокумент Из СписокДокументов Цикл
		УстановитьДоступностьСервер(ТекущийДокумент.Значение);
		Оповестить("ИзменениеРеквизитовДоступности", ТекущийДокумент.Значение, ЭтаФорма.ВладелецФормы);
	КонецЦикла;
	Предупреждение("Успешно!");
	ОповеститьОбИзменении(Тип("ДокументСсылка.Д_Бюджет"));
	Закрыть();
КонецПроцедуры

&НаСервере
Процедура УстановитьДоступностьСервер(ТекущийДокумент)
	
	БюджетныйНаСервере.ИзменитьПоследнююЗаписьПараметровБюджета(ТекущийДокумент.Предприятие, ТекущийДокумент.Сценарий, Утвержден, ПризнакРедактирования, ПризнакРедактированияБО);
	
КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Для Каждого ТекущийДокумент Из Параметры.СписокДокументов Цикл
		НоваяСтрока = СписокДокументов.Добавить(ТекущийДокумент);
	КонецЦикла;
	
	Если Параметры.СписокДокументов.Количество() = 1 Тогда
		
		Запрос = Новый Запрос;
		Запрос.Текст = "ВЫБРАТЬ
		|	Б_ПараметрыБюджета.Утвержден КАК Утвержден,
		|	Б_ПараметрыБюджета.ПризнакРедактирования КАК ПризнакРедактирования,
		|	Б_ПараметрыБюджета.ПризнакРедактированияБО КАК ПризнакРедактированияБО
		|ИЗ
		|	РегистрСведений.Б_ПараметрыБюджета КАК Б_ПараметрыБюджета
		|ГДЕ
		|	Б_ПараметрыБюджета.Предприятие = &Предприятие
		|	И Б_ПараметрыБюджета.Сценарий = &Сценарий";
		
		Запрос.УстановитьПараметр("Предприятие", СписокДокументов[0].Значение.Предприятие);
		Запрос.УстановитьПараметр("Сценарий", СписокДокументов[0].Значение.Сценарий);
		
		Результат = Запрос.Выполнить();
		Выборка = Результат.Выбрать();
		
		Пока Выборка.Следующий() Цикл
			ЗаполнитьЗначенияСвойств(ЭтотОбъект, Выборка);			
		КонецЦикла;
		
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура УстановитьСоответствиеМеждуУтверждениемИЗапретомРедактирования()
	Если Утвержден И Не ПризнакРедактирования Тогда
		ПризнакРедактирования = Истина;
	КонецЕсли;
КонецПроцедуры

