
&НаКлиенте
Процедура ОтразитьФакт(Команда)
	Объект.ОтраженФакт = Истина;
	Записать();	
	ЗаполнитьОтгрузкуФактическимиДанными(Объект.Ссылка);	
	ЭтаФорма.Закрыть();
КонецПроцедуры

&НаСервереБезКонтекста
Процедура ЗаполнитьОтгрузкуФактическимиДанными(Ссылка)
	
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("ТекущаяЗаявка", Ссылка);
	Запрос.Текст = "ВЫБРАТЬ
	               |	КС_ДвиженияГПОтгрузки.Ссылка
	               |ИЗ
	               |	Документ.КС_ДвиженияГП.Отгрузки КАК КС_ДвиженияГПОтгрузки
	               |ГДЕ
	               |	КС_ДвиженияГПОтгрузки.Заявка = &ТекущаяЗаявка";
				   
	Выборка = Запрос.Выполнить().Выбрать();
	
	Если Выборка.Следующий() Тогда
		
		ДокСсылка = Выборка.Ссылка;
		ДокОбъект = ДокСсылка.ПолучитьОбъект();
		
		СтрокаТекущейОтгрузки = ДокОбъект.Отгрузки.Найти(Ссылка, "Заявка");
		
		Если СтрокаТекущейОтгрузки <> Неопределено Тогда
			
			СтрокаТекущейОтгрузки.Объем = Ссылка.ОбъемОтгрузки;
			СтрокаТекущейОтгрузки.Перенос = ?(НачалоДня(Ссылка.ФактическаяДатаОтгрузки) = НачалоДня(ДокОбъект.Дата), Ложь, Истина);
			
		КонецЕсли;
		
		ДокОбъект.Записать();
		
	КонецЕсли;
	
	
КонецПроцедуры