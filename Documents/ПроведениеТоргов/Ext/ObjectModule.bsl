
Процедура ОбработкаПроведения(Отказ, Режим)

	ТаблицаНоменклатурКорзины = КорзинаТоргов.Товары.Выгрузить();
	
	// регистр Торги
	Движения.Торги.Записывать = Истина;
	Для Каждого ТекСтрокаТовары Из ТаблицаНоменклатурКорзины Цикл
		Движение = Движения.Торги.Добавить();
		Движение.Период = Дата;
		Движение.Номенклатура = ТекСтрокаТовары.Номенклатура;
		Движение.Корзина = КорзинаТоргов;
		НайденныеСтроки = Товары.НайтиСтроки(Новый Структура("Номенклатура", ТекСтрокаТовары.Номенклатура));
		Если НайденныеСтроки.Количество() = 0 Тогда
			Движение.ВыведенаИзТоргов = Истина;
		КонецЕсли;	
	КонецЦикла;

	//регистр цен	
	Движения.ЦеныНоменклатуры.Записывать = Истина;
	Для Каждого СтрокаПодразделений Из Подразделения Цикл
		Для Каждого ТекСтрокаЦены Из Товары Цикл
			Движение = Движения.ЦеныНоменклатуры.Добавить();
			Движение.Номенклатура = ТекСтрокаЦены.Номенклатура;
			Движение.Предприятие = Предприятие;
			Движение.ВидЦены = ТекСтрокаЦены.ВидЦены;
			Движение.Цена = ТекСтрокаЦены.Цена;
			Движение.Период = Дата;
			Движение.Подразделение = СтрокаПодразделений.Подразделение;
		КонецЦикла;
	КонецЦикла;

	ДвиженияПоРегиструНоменклатурыПоставщика();
	
КонецПроцедуры

Процедура ДвиженияПоРегиструНоменклатурыПоставщика()
	
	Движения.НоменклатураПоставщика.Записывать = Истина;
	Для Каждого СтрокаПодразделений Из Подразделения Цикл
		Для Каждого ТекСтрокаЦены Из Товары Цикл
			Движение = Движения.НоменклатураПоставщика.Добавить();
			Движение.Контрагент = ТекСтрокаЦены.Контрагент;
			Движение.Номенклатура = ТекСтрокаЦены.Номенклатура;
			Движение.Период = Дата;
			Движение.Автор = ПараметрыСеанса.ТекущийПользователь;
			Движение.Подразделение = СтрокаПодразделений.Подразделение;
			Движение.Предприятие = Предприятие;
		КонецЦикла;
	КонецЦикла;
	
КонецПроцедуры

Процедура ОбработкаПроверкиЗаполнения(Отказ, ПроверяемыеРеквизиты)
	
	
	
КонецПроцедуры

Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)
	//из подписки на событие
	БюджетныйНаСервере.ДокументыПередЗаписьюПередЗаписью(ЭтотОбъект, Отказ, РежимЗаписи, РежимПроведения);
КонецПроцедуры

Процедура ПриУстановкеНовогоНомера(СтандартнаяОбработка, Префикс)
	БюджетныйНаСервере.ПриУстановкеНовогоНомераПриУстановкеНовогоНомера(ЭтотОбъект, СтандартнаяОбработка, Префикс);
КонецПроцедуры
