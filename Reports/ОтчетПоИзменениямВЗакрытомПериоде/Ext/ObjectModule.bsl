
Процедура ПриКомпоновкеРезультата(ДокументРезультат, ДанныеРасшифровки, СтандартнаяОбработка)
	
	ВыбраннаяДатаЗапрета = КомпоновщикНастроек.Настройки.ПараметрыДанных.Элементы.Найти("Дата").Значение;
	Если ЗначениеЗаполнено(ВыбраннаяДатаЗапрета) Тогда
		Запрос = Новый Запрос;
		Запрос.Текст = "ВЫБРАТЬ РАЗЛИЧНЫЕ	
		               |	ДатыЗапретаИзменения.ДатаЗапрета КАК ГлобальнаяДатаЗапрета
		               |ИЗ
		               |	РегистрСведений.ДатыЗапретаИзменения КАК ДатыЗапретаИзменения
		               |ГДЕ
		               |	ДатыЗапретаИзменения.Объект = ЗНАЧЕНИЕ(Перечисление.ВидыНазначенияДатЗапрета.ПоВсемОбъектам)
		               |	И ДатыЗапретаИзменения.Пользователь = ЗНАЧЕНИЕ(Перечисление.ВидыНазначенияДатЗапрета.ПоВсемПользователям)";
		МассивДат = Запрос.Выполнить().Выгрузить().ВыгрузитьКолонку("ГлобальнаяДатаЗапрета");
		 
		//Установим границы периода отчета. КонечнаяДата - выбранная дата в параметрах, НачальнаяДата - предыдущая дата запрета редактирования до выбранной
		ПредыдущаяДатаЗапрета = '00010101';
		Если МассивДат.Количество() > 0 Тогда 
			Для Ы = 1 По МассивДат.Количество() - 1 Цикл
				Если МассивДат[Ы] = ВыбраннаяДатаЗапрета Тогда
					ПредыдущаяДатаЗапрета = МассивДат[Ы-1];
				КонецЕсли;
			КонецЦикла;
		КонецЕсли;
		
	Иначе //за все время
		ПредыдущаяДатаЗапрета = '00010101';
		ВыбраннаяДатаЗапрета  = КонецГода(ТекущаяДата());
	КонецЕсли;
	 
	ПараметрСКД = КомпоновщикНастроек.Настройки.ПараметрыДанных.Элементы.Найти("Период");
	ПараметрСКД.Значение = новый  СтандартныйПериод(ПредыдущаяДатаЗапрета, ВыбраннаяДатаЗапрета);
	ПараметрСКД.Использование = Истина;
	 
КонецПроцедуры
