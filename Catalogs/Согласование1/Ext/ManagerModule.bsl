Функция ФормаВыполненияСправочники(ЗадачаСсылка, ТочкаМаршрутаСсылка, Выборка) Экспорт
	
	//Если ТочкаМаршрутаСсылка = Перечисления.Согласование1ТочкиМаршрута.Действие1 Тогда 
	//	ИмяФормы = "Справочник.Согласование1.Форма.ФормаПодготовки";
	//	
	//ИначеЕсли ТочкаМаршрутаСсылка = Перечисления.Согласование1ТочкиМаршрута.Действие3 Тогда 
	//	ИмяФормы = "Справочник.Согласование1.Форма.ФормаКонтроля";
	//	
	//ИначеЕсли ТочкаМаршрутаСсылка = Перечисления.Согласование1ТочкиМаршрута.Действие5 Тогда 
	//	ИмяФормы = "Справочник.Согласование1.Форма.ФормаОплаты";
	//Иначе
	//	ИмяФормы = "Справочник.Согласование1.Форма.ФормаСогласования";		
	//КонецЕсли;	
	
	ИмяФормы = "Справочник.Согласование1.Форма." + ИмяФормыВыполненияСправочники(ТочкаМаршрутаСсылка);
		
	Результат = Новый Структура;
	Результат.Вставить("ПараметрыФормы", Новый Структура("Ключ, ТочкаМаршрута, Исполнитель, Должность",
			ЗадачаСсылка, ТочкаМаршрутаСсылка.Имя, Выборка.Исполнитель, Выборка.Должность));
	Результат.Вставить("ИмяФормы", ИмяФормы);
	Возврат Результат;
	
КонецФункции

Функция ИмяФормыВыполненияСправочники(ТочкаМаршрутаСсылка) Экспорт
	
	Если ТочкаМаршрутаСсылка = Перечисления.Согласование1ТочкиМаршрута.Действие1 Тогда 
		Возврат "ФормаПодготовки";
		
	ИначеЕсли ТочкаМаршрутаСсылка = Перечисления.Согласование1ТочкиМаршрута.Действие3 Тогда 
		Возврат "ФормаКонтроля";
		
	ИначеЕсли ТочкаМаршрутаСсылка = Перечисления.Согласование1ТочкиМаршрута.Действие5 Тогда 
		Возврат "ФормаОплаты";
		
	Иначе
		Возврат "ФормаСогласования";		
	КонецЕсли;
	
КонецФункции

Функция ПолучитьСотрудникаОФК(Заявка = Неопределено) Экспорт
	
	СотрудникОФК = Неопределено;
	Для каждого ТекЗначение Из Метаданные.Перечисления.ОсновныеДолжностиПредприятия.ЗначенияПеречисления Цикл
		Если ТекЗначение.Имя = "ОтветственныйЗаФК" И НЕ Заявка.Метаданные().Реквизиты.Найти("Предприятие") = Неопределено Тогда
			Запрос = новый Запрос;
			Запрос.УстановитьПараметр("Предприятие", Заявка.Предприятие);
			Запрос.Текст = "ВЫБРАТЬ
			|	ОсновныеДолжностиПредприятия.Сотрудник
			|ИЗ
			|	РегистрСведений.ОсновныеДолжностиПредприятия КАК ОсновныеДолжностиПредприятия
			|ГДЕ
			|	ОсновныеДолжностиПредприятия.Предприятие = &Предприятие
			|	И ОсновныеДолжностиПредприятия.Должность = ЗНАЧЕНИЕ(Перечисление.ОсновныеДолжностиПредприятия.ОтветственныйЗаФК)";
			Выборка = Запрос.Выполнить().Выбрать();
			Если Выборка.Следующий() И ЗначениеЗаполнено(Выборка.Сотрудник) Тогда
				СотрудникОФК = Выборка.Сотрудник;
			КонецЕсли;
		КонецЕсли;	
	КонецЦикла; 
	
		
КонецФункции

Процедура ДобавитьСтрокуДопСогласование(ТекОбъект, ТекПользователь)	Экспорт

	Если Не ПустаяСтрока(ТекПользователь) Тогда
		ОтобранныеСтроки = ТекОбъект.ДопСогласование.НайтиСтроки(Новый Структура("СубъектСогласования", ТекПользователь));
		Если НЕ ОтобранныеСтроки.Количество() Тогда
			НоваяСтрока = ТекОбъект.ДопСогласование.Добавить();
			НоваяСтрока.СубъектСогласования = ТекПользователь;
			НоваяСтрока.РезультирующееСогласование = ТекПользователь.РезультирующееСогласование;
		КонецЕсли;
	КонецЕсли;
	

КонецПроцедуры

Процедура ДобавитьСтрокуДопОзнакомление(ТекОбъект, ТекПользователь)	Экспорт
	
	Если Не ПустаяСтрока(ТекПользователь) Тогда
		ОтобранныеСтроки = ТекОбъект.ДопОповещение.НайтиСтроки(Новый Структура("Пользователь", ТекПользователь));
		Если НЕ ОтобранныеСтроки.Количество() Тогда
			НоваяСтрока = ТекОбъект.ДопОповещение.Добавить();
			НоваяСтрока.Пользователь = ТекПользователь;
		КонецЕсли;
	КонецЕсли;
КонецПроцедуры

Процедура ДобавитьСтрокуДопИсполнение(ТекОбъект, ТекОснование) Экспорт
	
	ТекПользователи = Документы.Д_ЗаявкаНаОплату.ПолучитьИсполнителейОплаты(ТекОснование);
	
	Для каждого ТекПользователь Из ТекПользователи Цикл
		Если ЗначениеЗаполнено(ТекПользователь) Тогда
			ОтобранныеСтроки = ТекОбъект.ДопИсполнение.НайтиСтроки(Новый Структура("Исполнитель", ТекПользователь));
			Если НЕ ОтобранныеСтроки.Количество() Тогда
				НоваяСтрока = ТекОбъект.ДопИсполнение.Добавить();
				НоваяСтрока.Исполнитель = ТекПользователь;
			КонецЕсли;
		КонецЕсли;
	КонецЦикла; 
	
КонецПроцедуры
