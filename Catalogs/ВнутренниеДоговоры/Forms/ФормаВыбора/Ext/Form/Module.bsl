
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Параметры.ЗаполнятьОтборДляВНХ = Ложь;
	Список.Параметры.УстановитьЗначениеПараметра("ДоступныеПредприятия", ПараметрыСеанса.ДоступныеПредприятия); 
	Если ЭтотОбъект.Параметры.Отбор.Свойство("Владелец") Тогда
		КонтрагентОтбора = ЭтотОбъект.Параметры.Отбор.Владелец;
		Если ЗначениеЗаполнено(КонтрагентОтбора) И
			ТипЗнч(КонтрагентОтбора) = Тип("СправочникСсылка.Контрагенты") Тогда
			Если КонтрагентОтбора.ОрганизацияВГОВНХ И ЗначениеЗаполнено(КонтрагентОтбора.ЭтоОрганизация) Тогда   
				Параметры.ОрганизацияКонтрагента = КонтрагентОтбора.ЭтоОрганизация;
				Параметры.Контрагент = КонтрагентОтбора; 
				Если ЭтотОбъект.Параметры.Отбор.Свойство("Предприятие") Тогда
					Параметры.Предприятие = ЭтотОбъект.Параметры.Отбор.Предприятие;
				КонецЕсли;
				Параметры.ЗаполнятьОтборДляВНХ = Истина;
				ЭтотОбъект.Параметры.Отбор.Удалить("Владелец");
				Список.ТекстЗапроса = СтрЗаменить(Список.ТекстЗапроса,
				"СправочникВнутренниеДоговоры.Предприятие В (&ДоступныеПредприятия)",
				"СправочникВнутренниеДоговоры.Предприятие В (&ДоступныеПредприятия) И (Выбор Когда &ОтборприСоздании = Истина Тогда
				|(СправочникВнутренниеДоговоры.Владелец = &Контрагент ИЛИ СправочникВнутренниеДоговоры.ОрганизацияВладельца = &ОрганизацияВладельца)
				|Иначе
				| Истина Конец)");
				Список.Параметры.УстановитьЗначениеПараметра("ОтборприСоздании", Истина); 
				Список.Параметры.УстановитьЗначениеПараметра("Контрагент", КонтрагентОтбора); 
				Список.Параметры.УстановитьЗначениеПараметра("ОрганизацияВладельца", КонтрагентОтбора.ЭтоОрганизация);
			КонецЕсли;
		КонецЕсли; 
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура СписокПередНачаломДобавления(Элемент, Отказ, Копирование, Родитель, Группа, Параметр)
	
	Если Не Копирование Тогда
		Если Параметры.ЗаполнятьОтборДляВНХ Тогда 
			ПараметрыФормы = Новый Структура("Контрагент,ОрганизацияКонтрагента,Предприятие,ЗаполнятьОтборДляВНХ",Параметры.Контрагент,Параметры.ОрганизацияКонтрагента,Параметры.Предприятие,Параметры.ЗаполнятьОтборДляВНХ); 
			Отказ = Истина; 
			ОткрытьФорму("Справочник.ВнутренниеДоговоры.Форма.ФормаЭлемента",ПараметрыФормы); 
		КонецЕсли;
	КонецЕсли; 
	
КонецПроцедуры
